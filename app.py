{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "b659af45-2969-41e4-a1fe-6f5828c2ac23",
   "metadata": {},
   "outputs": [],
   "source": [
    "with open(\"app.py\", \"w\") as file:\n",
    "    file.write('''\n",
    "import streamlit as st\n",
    "import re\n",
    "import io\n",
    "from docx import Document\n",
    "from PyPDF2 import PdfReader\n",
    "from reportlab.lib.pagesizes import letter\n",
    "from reportlab.pdfgen import canvas\n",
    "from PIL import Image, ImageDraw, ImageFilter\n",
    "import pytesseract\n",
    "import cv2\n",
    "import numpy as np\n",
    "from moviepy.editor import ImageSequenceClip\n",
    "\n",
    "# Function to extract text from Word documents\n",
    "def extract_text_from_word(doc_file):\n",
    "    doc = Document(doc_file)\n",
    "    paragraphs = []\n",
    "    for para in doc.paragraphs:\n",
    "        paragraphs.append(para.text)\n",
    "    return paragraphs, doc\n",
    "\n",
    "# Function to extract text from PDF documents\n",
    "def extract_text_from_pdf(pdf_file):\n",
    "    reader = PdfReader(pdf_file)\n",
    "    paragraphs = []\n",
    "    for page in reader.pages:\n",
    "        paragraphs.append(page.extract_text())\n",
    "    return paragraphs\n",
    "\n",
    "# Function to mask sensitive data in text\n",
    "def mask_sensitive_data(paragraphs, selected_options):\n",
    "    regex_patterns = {\n",
    "        \"Emails\": r'\\\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\\\.com\\\\b',\n",
    "        \"Phone Numbers\": r'\\\\b\\\\d{10}\\\\b',  # Exactly 10 digits\n",
    "        \"Account Numbers\": r'\\\\b\\\\d{11,14}\\\\b',  # Between 11 and 14 digits\n",
    "        \"IFSC Codes\": r'\\\\b[A-Z]{4}\\\\d{7}\\\\b'\n",
    "    }\n",
    "    \n",
    "    masked_paragraphs = []\n",
    "    for paragraph in paragraphs:\n",
    "        masked_paragraph = paragraph\n",
    "        for option in selected_options:\n",
    "            if option in regex_patterns:\n",
    "                masked_paragraph = re.sub(regex_patterns[option], '[DATA HIDDEN]', masked_paragraph)\n",
    "        masked_paragraphs.append(masked_paragraph)\n",
    "    \n",
    "    return masked_paragraphs\n",
    "\n",
    "# Function to create Word document with masked data\n",
    "def create_word(masked_paragraphs):\n",
    "    buffer = io.BytesIO()\n",
    "    new_doc = Document()\n",
    "    for paragraph in masked_paragraphs:\n",
    "        new_doc.add_paragraph(paragraph)\n",
    "    new_doc.save(buffer)\n",
    "    buffer.seek(0)\n",
    "    return buffer\n",
    "\n",
    "# Function to create PDF with masked data\n",
    "def create_pdf(masked_paragraphs):\n",
    "    buffer = io.BytesIO()\n",
    "    pdf_canvas = canvas.Canvas(buffer, pagesize=letter)\n",
    "    text_object = pdf_canvas.beginText(40, 750)\n",
    "    for paragraph in masked_paragraphs:\n",
    "        lines = paragraph.split(\"\\\\n\")\n",
    "        for line in lines:\n",
    "            text_object.textLine(line)\n",
    "    pdf_canvas.drawText(text_object)\n",
    "    pdf_canvas.showPage()\n",
    "    pdf_canvas.save()\n",
    "    buffer.seek(0)\n",
    "    return buffer\n",
    "\n",
    "# Function to blur \n",
    "def blur_area(image, box):\n",
    "    region = image.crop(box)\n",
    "    blurred_region = region.filter(ImageFilter.GaussianBlur(radius=5))\n",
    "    image.paste(blurred_region, box)\n",
    "\n",
    "# Function to process image \n",
    "def process_image(image, selected_options):\n",
    "    pytesseract.pytesseract.tesseract_cmd = r'C:\\\\Program Files\\\\Tesseract-OCR\\\\tesseract.exe'\n",
    "    data = pytesseract.image_to_data(image, output_type=pytesseract.Output.DICT)\n",
    "    \n",
    "    patterns = {\n",
    "        \"Emails\": r'[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\\\.[a-zA-Z0-9-.]+',\n",
    "        \"Phone Numbers\": r'\\\\b\\\\d{10}\\\\b',\n",
    "        \"Account Numbers\": r'\\\\b\\\\d{11,14}\\\\b',\n",
    "        \"IFSC Codes\": r'\\\\b[A-Z]{4}\\\\d{7}\\\\b'\n",
    "    }\n",
    "    \n",
    "    for i, text in enumerate(data['text']):\n",
    "        for option in selected_options:\n",
    "            if re.match(patterns.get(option, ''), text):\n",
    "                x, y, w, h = data['left'][i], data['top'][i], data['width'][i], data['height'][i]\n",
    "                blur_area(image, (x, y, x + w, y + h))\n",
    "    return image\n",
    "\n",
    "# Function to process a single frame for sensitive data\n",
    "def process_frame(frame, selected_options):\n",
    "    image = Image.fromarray(cv2.cvtColor(frame, cv2.COLOR_BGR2RGB))\n",
    "    \n",
    "    pytesseract.pytesseract.tesseract_cmd = r'C:\\\\Program Files\\\\Tesseract-OCR\\\\tesseract.exe'\n",
    "    data = pytesseract.image_to_data(image, output_type=pytesseract.Output.DICT)\n",
    "    \n",
    "    patterns = {\n",
    "        \"Emails\": r'[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\\\.[a-zA-Z0-9-.]+',\n",
    "        \"Phone Numbers\": r'\\\\b\\\\d{10}\\\\b',\n",
    "        \"Account Numbers\": r'\\\\b\\\\d{11,14}\\\\b',\n",
    "        \"IFSC Codes\": r'\\\\b[A-Z]{4}\\\\d{7}\\\\b'\n",
    "    }\n",
    "    \n",
    "    for i, text in enumerate(data['text']):\n",
    "        for option in selected_options:\n",
    "            if re.match(patterns.get(option, ''), text):\n",
    "                x, y, w, h = data['left'][i], data['top'][i], data['width'][i], data['height'][i]\n",
    "                blur_area(image, (x, y, x + w, y + h))\n",
    "    \n",
    "    return cv2.cvtColor(np.array(image), cv2.COLOR_RGB2BGR)\n",
    "\n",
    "# Function to process video \n",
    "def process_video(video_path, selected_options):\n",
    "    cap = cv2.VideoCapture(video_path)\n",
    "    frames = []\n",
    "    \n",
    "    while True:\n",
    "        ret, frame = cap.read()\n",
    "        if not ret:\n",
    "            break\n",
    "        processed_frame = process_frame(frame, selected_options)\n",
    "        frames.append(processed_frame)\n",
    "    \n",
    "    cap.release()\n",
    "    return frames\n",
    "\n",
    "st.title(\"Sensitive Data Masking in Files, Images, and Videos\")\n",
    "\n",
    "# File uploader for Word, PDF, Image, or Video\n",
    "uploaded_file = st.file_uploader(\"Upload a Word, PDF, Image, or Video file\", type=[\"docx\", \"pdf\", \"png\", \"jpg\", \"jpeg\", \"mp4\", \"avi\", \"mov\"])\n",
    "\n",
    "if uploaded_file is not None:\n",
    "    file_type = uploaded_file.type\n",
    "    if file_type in [\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\", \"application/pdf\"]:\n",
    "        if file_type == \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\":\n",
    "            paragraphs, _ = extract_text_from_word(uploaded_file)\n",
    "        elif file_type == \"application/pdf\":\n",
    "            paragraphs = extract_text_from_pdf(uploaded_file)\n",
    "        \n",
    "        extracted_text = \"\\\\n\".join(paragraphs)\n",
    "        st.subheader(\"Extracted Text:\")\n",
    "        st.write(extracted_text)\n",
    "        \n",
    "        options = [\"Emails\", \"Phone Numbers\", \"Account Numbers\", \"IFSC Codes\"]\n",
    "        selected_options = st.multiselect(\"Select data types to mask:\", options)\n",
    "\n",
    "        if st.button(\"Mask Sensitive Data\"):\n",
    "            if selected_options:\n",
    "                masked_paragraphs = mask_sensitive_data(paragraphs, selected_options)\n",
    "                masked_text = \"\\\\n\".join(masked_paragraphs)\n",
    "                st.subheader(\"Text with Sensitive Data Hidden:\")\n",
    "                st.write(masked_text)\n",
    "                \n",
    "                if file_type == \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\":\n",
    "                    word_buffer = create_word(masked_paragraphs)\n",
    "                    st.download_button(\"Download Masked Word File\", word_buffer, \"masked_data.docx\")\n",
    "                elif file_type == \"application/pdf\":\n",
    "                    pdf_buffer = create_pdf(masked_paragraphs)\n",
    "                    st.download_button(\"Download Masked PDF File\", pdf_buffer, \"masked_data.pdf\")\n",
    "            else:\n",
    "                st.warning(\"Please select at least one data type to mask.\")\n",
    "    \n",
    "    elif file_type in [\"image/png\", \"image/jpeg\", \"image/jpg\"]:\n",
    "        image = Image.open(uploaded_file)\n",
    "        st.image(image, caption=\"Original Image\", use_column_width=True)\n",
    "        \n",
    "        image_options = [\"Emails\", \"Phone Numbers\", \"Account Numbers\", \"IFSC Codes\"]\n",
    "        selected_image_options = st.multiselect(\"Select data types to hide in the image:\", image_options)\n",
    "        \n",
    "        if st.button(\"Blur Sensitive Data\"):\n",
    "            if selected_image_options:\n",
    "                blurred_image = process_image(image, selected_image_options)\n",
    "                st.image(blurred_image, caption=\"Image with Sensitive Data Blurred\", use_column_width=True)\n",
    "                buf = io.BytesIO()\n",
    "                blurred_image.save(buf, format=\"PNG\")\n",
    "                st.download_button(\"Download Blurred Image\", buf, \"blurred_image.png\")\n",
    "            else:\n",
    "                st.warning(\"Please select at least one data type to blur in the image.\")\n",
    "    \n",
    "    elif file_type in [\"video/mp4\", \"video/avi\", \"video/mov\"]:\n",
    "        st.video(uploaded_file)\n",
    "        \n",
    "        video_path = \"uploaded_video.mp4\"\n",
    "        with open(video_path, \"wb\") as f:\n",
    "            f.write(uploaded_file.getbuffer())\n",
    "        \n",
    "        video_options = [\"Emails\", \"Phone Numbers\", \"Account Numbers\", \"IFSC Codes\"]\n",
    "        selected_video_options = st.multiselect(\"Select data types to mask in the video:\", video_options)\n",
    "\n",
    "        if st.button(\"Mask Sensitive Data\"):\n",
    "            if selected_video_options:\n",
    "                frames = process_video(video_path, selected_video_options)\n",
    "                clip = ImageSequenceClip(frames, fps=24)\n",
    "                processed_video_path = \"processed_video.mp4\"\n",
    "                clip.write_videofile(processed_video_path)\n",
    "                \n",
    "                with open(processed_video_path, \"rb\") as video_file:\n",
    "                    st.download_button(\"Download Masked Video\", video_file, file_name=\"masked_video.mp4\")\n",
    "            else:\n",
    "                st.warning(\"Please select at least one data type to mask.\")\n",
    "    else:\n",
    "        st.error(\"Unsupported file type.\")\n",
    "    ''')\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "46468dae-3764-474b-a9b2-af2d53e77dfa",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "^C\n"
     ]
    }
   ],
   "source": [
    "!streamlit run app.py"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "da7664db-217d-457e-a2d6-f1ac9b53a534",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.10"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
